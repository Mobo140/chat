# Chat Service

Chat Service - это микросервис для обмена сообщениями в реальном времени, разработанный на Go с использованием gRPC. Сервис обеспечивает создание чатов и обмен сообщениями между пользователями.

## Функциональность

### Управление чатами

- Создание чатов между пользователями
- Получение информации о чате по ID
- Удаление чатов
- Подключение пользователей к чату
- Отправка сообщений в реальном времени

### Обмен сообщениями

- Потоковая передача сообщений
- Доставка сообщений всем участникам чата
- Хранение истории сообщений

## Технологический стек

- Go 1.19+
- gRPC/Protobuf
- PostgreSQL (хранение чатов и сообщений)
- OpenTracing (трейсинг)
- Zap (логирование)
- Docker
- Make

## API

### Chat Service (chat_v1)

Управление чатами:

- Create - создание нового чата
- Get - получение информации о чате по ID
- Delete - удаление чата
- ConnectChat - подключение к чату для получения сообщений
- SendMessage - отправка сообщения в чат

## Особенности реализации

### Безопасность

- Проверка прав доступа к чатам
- Интеграция с Auth Service для аутентификации
- Валидация входящих данных

### Производительность

- Асинхронная обработка сообщений
- Буферизированные каналы для сообщений
- Оптимизированная работа с базой данных

### Мониторинг и логирование

- Трейсинг запросов через OpenTracing
- Структурированное логирование с использованием Zap
- Детальное логирование операций с чатами

## Процесс обмена сообщениями

### Подключение к чату

1. Клиент запрашивает подключение к чату через ConnectChat
2. Сервис проверяет права доступа
3. Устанавливается двунаправленный стрим
4. Клиент готов отправлять и получать сообщения

### Отправка сообщений

1. Клиент отправляет сообщение через SendMessage
2. Сервис проверяет права доступа
3. Сообщение сохраняется в базе данных
4. Сообщение доставляется всем подключенным участникам чата

## Взаимодействие с другими сервисами

### Схема взаимодействия

1. Клиент -> Auth Service: аутентификация
2. Клиент -> Chat Service: операции с чатами
3. Chat Service -> Auth Service: проверка токенов
4. Chat Service -> Client: доставка сообщений

### Процесс проверки доступа

1. Сервис получает запрос с токеном
2. Проверяет валидность токена через Auth Service
3. Проверяет права доступа к конкретному чату
4. Разрешает или отклоняет операцию
